<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transfer Logistics</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style>
      body {
        padding: 16px;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans,
          Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      }
      .container {
        width: 98%;
        max-width: initial;
      }
      .group-card {
        margin-bottom: 18px;
      }
      .btn-group .btn {
        margin-right: 8px;
        margin-bottom: 8px;
      }
      #modal-add h6,
      #modal-edit h6 {
        margin: 10px 0 2px 0;
        font-size: 0.9rem;
        color: #555;
      }
      .hidden-input,
      .hidden-file-input {
        display: none;
      }

      /* --- Balanced Compact Table Styles --- */
      .group-card .card-content {
        padding: 12px 16px;
      }
      .table-col-toggle th,
      .table-col-toggle td {
        padding: 10px 8px;
        font-size: 0.88rem;
        vertical-align: middle;
      }
      .table-col-toggle th {
        white-space: nowrap;
      }
      .table-col-toggle .input-field {
        margin: 0;
      }
      .table-col-toggle input[type="date"],
      .table-col-toggle input[type="time"],
      .table-col-toggle .browser-default {
        height: 2.2rem;
        font-size: 0.9rem;
        padding: 0 5px;
        border-radius: 3px;
        border: 1px solid #ddd;
        box-sizing: border-box;
      }
      .table-col-toggle .materialize-textarea {
        padding: 5px !important;
        min-height: 38px;
        line-height: 1.3;
      }

      /* --- Column Visibility & Reordering --- */
      #column-manager-wrapper {
        border: 1px solid #e0e0e0;
        padding: 10px;
        border-radius: 4px;
        position: relative;
      }
      #column-manager-wrapper h6 {
        font-size: 1rem;
        color: #444;
        margin-top: 5px;
      }
      #btn-reset-cols {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 0.8rem;
      }
      .col-dragger-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 40px;
        background: #f9f9f9;
        padding: 8px;
        border-radius: 4px;
      }
      .col-chip {
        cursor: grab;
        display: inline-flex;
        align-items: center;
        background-color: #e0e0e0;
        border-radius: 16px;
        padding: 0 12px;
        height: 32px;
        font-size: 13px;
      }
      .col-chip .visibility-toggle {
        cursor: pointer;
        margin-left: 8px;
        color: #666;
      }
      .col-chip.sortable-ghost {
        background: #bbdefb;
      }
      #hidden-cols-container .col-chip {
        background-color: #f5f5f5;
        color: #9e9e9e;
      }

      .table-col-toggle th,
      .table-col-toggle td {
        display: none;
      }
      .table-col-toggle th.col-actions,
      .table-col-toggle td.col-actions {
        display: table-cell;
      }

      body.show-type .table-col-toggle th.col-type,
      body.show-type .table-col-toggle td.col-type {
        display: table-cell;
      }
      body.show-lastName .table-col-toggle th.col-lastName,
      body.show-lastName .table-col-toggle td.col-lastName {
        display: table-cell;
      }
      body.show-firstName .table-col-toggle th.col-firstName,
      body.show-firstName .table-col-toggle td.col-firstName {
        display: table-cell;
      }
      body.show-originCity .table-col-toggle th.col-originCity,
      body.show-originCity .table-col-toggle td.col-originCity {
        display: table-cell;
      }
      body.show-destCity .table-col-toggle th.col-destCity,
      body.show-destCity .table-col-toggle td.col-destCity {
        display: table-cell;
      }
      body.show-originArea .table-col-toggle th.col-originArea,
      body.show-originArea .table-col-toggle td.col-originArea {
        display: table-cell;
      }
      body.show-destArea .table-col-toggle th.col-destArea,
      body.show-destArea .table-col-toggle td.col-destArea {
        display: table-cell;
      }
      body.show-companion .table-col-toggle th.col-companion,
      body.show-companion .table-col-toggle td.col-companion {
        display: table-cell;
      }
      body.show-transport .table-col-toggle th.col-transport,
      body.show-transport .table-col-toggle td.col-transport {
        display: table-cell;
      }
      body.show-date .table-col-toggle th.col-date,
      body.show-date .table-col-toggle td.col-date {
        display: table-cell;
      }
      body.show-time .table-col-toggle th.col-time,
      body.show-time .table-col-toggle td.col-time {
        display: table-cell;
      }
      body.show-instructions .table-col-toggle th.col-instructions,
      body.show-instructions .table-col-toggle td.col-instructions {
        display: table-cell;
      }
      body.show-new .table-col-toggle th.col-new,
      body.show-new .table-col-toggle td.col-new {
        display: table-cell;
      }
      body.show-leader .table-col-toggle th.col-leader,
      body.show-leader .table-col-toggle td.col-leader {
        display: table-cell;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-wrapper teal">
        <a href="#" class="brand-logo center" data-translate="app_title"
          >Transfer Logistics</a
        >
        <ul id="nav-mobile" class="left">
          <li>
            <a id="btn-settings" href="#modal-settings" class="modal-trigger"
              ><i class="fa fa-cog"></i
            ></a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="section">
        <div id="upload-section">
          <div class="row valign-wrapper">
            <div class="col s6">
              <h5 data-translate="upload_title">Start New Plan</h5>
            </div>
            <div
              class="col s6 input-field"
              style="max-width: 250px; margin-left: auto"
            >
              <select class="lang-select">
                <option value="en">English</option>
                <option value="pt">PortuguÃªs</option>
              </select>
              <label data-translate="language">Language</label>
            </div>
          </div>
          <div class="row">
            <div class="col s12 m6">
              <label data-translate="old_board_label"
                >Old transferboard (from)</label
              >
              <input id="file-old" type="file" accept=".xlsx,.xls,.csv" />
            </div>
            <div class="col s12 m6">
              <label data-translate="new_board_label"
                >New transferboard (to)</label
              >
              <input id="file-new" type="file" accept=".xlsx,.xls,.csv" />
            </div>
          </div>
          <a id="btn-process" class="btn" data-translate="process_upload"
            >Process upload</a
          >
          <hr style="margin: 30px 0" />
          <h5 data-translate="restore_title">Restore Plan from CSV</h5>
          <div class="row">
            <div class="col s12 m8">
              <label data-translate="restore_desc"
                >Upload travel_plans.csv file to restore progress</label
              >
              <input id="file-restore" type="file" accept=".csv" />
            </div>
            <div class="col s12 m4" style="padding-top: 25px">
              <a id="btn-restore" class="btn" data-translate="restore_button"
                >Restore</a
              >
            </div>
          </div>
        </div>

        <div class="btn-group">
          <a
            id="btn-export-pdf"
            class="btn btn-small green"
            data-translate="export_pdf"
            >Export PDF</a
          >
          <a
            id="btn-export-csv"
            class="btn btn-small blue"
            data-translate="export_csv"
            >Export CSV</a
          >
          <a
            id="btn-clear-local"
            class="btn btn-small red"
            data-translate="clear_all_travel"
            >Clear All Saved Travel</a
          >
        </div>
      </div>

      <div class="section" id="controls-section" style="display: none">
        <div id="column-manager-wrapper">
          <a
            id="btn-reset-cols"
            class="waves-effect waves-light"
            data-translate="reset_columns"
            >Reset Columns</a
          >
          <div class="row" style="margin-bottom: 5px">
            <div class="col s12 m6">
              <h6 data-translate="visible_columns_label">
                Visible Columns (drag to reorder)
              </h6>
              <div
                id="visible-cols-container"
                class="col-dragger-container"
              ></div>
            </div>
            <div class="col s12 m6">
              <h6 data-translate="hidden_columns_label">Hidden Columns</h6>
              <div
                id="hidden-cols-container"
                class="col-dragger-container"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" id="tabs-section" style="display: none">
        <div class="col s12">
          <ul class="tabs">
            <li class="tab col s4">
              <a class="active" href="#tab-city" data-translate="tab_city"
                >By City</a
              >
            </li>
            <li class="tab col s4">
              <a href="#tab-transport" data-translate="tab_transport"
                >By Transport</a
              >
            </li>
            <li class="tab col s4">
              <a href="#tab-master" data-translate="tab_master">Master List</a>
            </li>
          </ul>
        </div>
        <div id="tab-city" class="col s12">
          <div class="section" style="padding-top: 1rem">
            <div id="groups-by-city"></div>
          </div>
        </div>
        <div id="tab-transport" class="col s12">
          <div class="section" style="padding-top: 1rem">
            <div id="groups-by-transport"></div>
          </div>
        </div>
        <div id="tab-master" class="col s12">
          <div class="section" style="padding-top: 1rem">
            <div id="groups-master"></div>
          </div>
        </div>
      </div>

      <div class="fixed-action-btn">
        <a class="btn-floating btn-large teal modal-trigger" href="#modal-add"
          ><i class="large material-icons">add</i></a
        >
      </div>
    </div>

    <div id="modal-add" class="modal">
      <div class="modal-content">
        <h5 data-translate="add_missionary_title">Add Missionary</h5>
        <div class="row">
          <div class="col s2">
            <h6 data-translate="type">Type</h6>
            <select id="add-type" class="browser-default">
              <option value="" disabled selected data-translate="choose_option">
                Choose...
              </option>
              <option value="Elder">Elder</option>
              <option value="Sister">Sister</option>
            </select>
          </div>
          <div class="col s4">
            <h6 data-translate="name">Name</h6>
            <input id="add-name" placeholder="Last, First" />
          </div>
          <div class="col s3">
            <h6 data-translate="origin_city">Origin City</h6>
            <select id="add-origin-select" class="browser-default"></select>
            <input
              id="add-origin-other"
              class="hidden-input"
              placeholder="Custom City"
            />
          </div>
          <div class="col s3">
            <h6 data-translate="dest_city">Destination City</h6>
            <select id="add-dest-select" class="browser-default"></select>
            <input
              id="add-dest-other"
              class="hidden-input"
              placeholder="Custom City"
            />
          </div>
        </div>
        <div class="row">
          <div class="col s3">
            <h6 data-translate="origin_area">Origin Area</h6>
            <input id="add-originarea" />
          </div>
          <div class="col s3">
            <h6 data-translate="dest_area">Destination Area</h6>
            <input id="add-destarea" />
          </div>
          <div class="col s3">
            <h6 data-translate="transportation">Transportation</h6>
            <select id="add-transport" class="browser-default"></select>
          </div>
          <div class="col s3">
            <h6 data-translate="table_header_companion">Companion</h6>
            <input id="add-companion" />
          </div>
        </div>
        <div class="row">
          <div class="col s2">
            <h6 data-translate="date">Date</h6>
            <input id="add-date" type="date" />
          </div>
          <div class="col s2">
            <h6 data-translate="departure_time">Departure Time</h6>
            <input id="add-time" type="time" />
          </div>
          <div class="col s5">
            <h6 data-translate="travel_instructions">Travel Instructions</h6>
            <input id="add-instructions" />
          </div>
          <div class="col s1" style="padding-top: 30px">
            <label
              ><input type="checkbox" id="add-new" />
              <span data-translate="table_header_new">New</span></label
            >
          </div>
          <div class="col s2" style="padding-top: 30px">
            <label>
              <input type="checkbox" id="add-leader" />
              <span data-translate="travel_leader">Travel Leader</span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a id="btn-add-save" class="modal-close btn" data-translate="save"
          >Save</a
        >
      </div>
    </div>

    <div id="modal-edit" class="modal">
      <div class="modal-content">
        <h5 data-translate="edit_missionary_title">Edit Missionary</h5>
        <input type="hidden" id="edit-id" />
        <div class="row">
          <div class="col s2">
            <h6 data-translate="type">Type</h6>
            <select id="edit-type" class="browser-default">
              <option value="Elder">Elder</option>
              <option value="Sister">Sister</option>
            </select>
          </div>
          <div class="col s4">
            <h6 data-translate="name">Name</h6>
            <input id="edit-name" placeholder="Last, First" />
          </div>
          <div class="col s3">
            <h6 data-translate="origin_city">Origin City</h6>
            <select id="edit-origin-select" class="browser-default"></select>
            <input
              id="edit-origin-other"
              class="hidden-input"
              placeholder="Custom City"
            />
          </div>
          <div class="col s3">
            <h6 data-translate="dest_city">Destination City</h6>
            <select id="edit-dest-select" class="browser-default"></select>
            <input
              id="edit-dest-other"
              class="hidden-input"
              placeholder="Custom City"
            />
          </div>
        </div>
        <div class="row">
          <div class="col s3">
            <h6 data-translate="origin_area">Origin Area</h6>
            <input id="edit-originarea" />
          </div>
          <div class="col s3">
            <h6 data-translate="dest_area">Destination Area</h6>
            <input id="edit-destarea" />
          </div>
          <div class="col s3">
            <h6 data-translate="transportation">Transportation</h6>
            <select id="edit-transport" class="browser-default"></select>
          </div>
          <div class="col s3">
            <h6 data-translate="table_header_companion">Companion</h6>
            <input id="edit-companion" />
          </div>
        </div>
        <div class="row">
          <div class="col s2">
            <h6 data-translate="date">Date</h6>
            <input id="edit-date" type="date" />
          </div>
          <div class="col s2">
            <h6 data-translate="departure_time">Departure Time</h6>
            <input id="edit-time" type="time" />
          </div>
          <div class="col s5">
            <h6 data-translate="travel_instructions">Travel Instructions</h6>
            <input id="edit-instructions" />
          </div>
          <div class="col s3" style="padding-top: 30px">
            <label>
              <input type="checkbox" id="edit-leader" />
              <span data-translate="travel_leader">Travel Leader</span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a id="btn-edit-save" class="modal-close btn" data-translate="save"
          >Save</a
        >
      </div>
    </div>

    <div id="modal-settings" class="modal">
      <div class="modal-content">
        <h5 data-translate="settings">Settings</h5>
        <div class="row">
          <div class="input-field col s6">
            <select class="lang-select">
              <option value="en">English</option>
              <option value="pt">PortuguÃªs</option>
            </select>
            <label data-translate="language">Language</label>
          </div>
        </div>
        <h6 data-translate="exceptions_title">Area/District Exceptions</h6>
        <div id="exceptions-list"></div>
        <div class="section">
          <h6 data-translate="add_exception_title">Add New Exception</h6>
          <div class="row">
            <div class="input-field col s5">
              <input id="ex-add-name" type="text" />
              <label for="ex-add-name" data-translate="area_zone_name"
                >Area/District/Zone Name</label
              >
            </div>
            <div class="input-field col s5">
              <input id="ex-add-city" type="text" />
              <label for="ex-add-city" data-translate="override_city"
                >Override City</label
              >
            </div>
            <div class="input-field col s2">
              <a id="btn-save-exception" class="btn" data-translate="save"
                >Save</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="modal-map" class="modal">
      <div class="modal-content">
        <h5 data-translate="map_columns_title">Map columns...</h5>
        <div id="mapping-forms"></div>
      </div>
      <div class="modal-footer">
        <a
          id="btn-map-apply"
          class="modal-close btn"
          data-translate="apply_mapping"
          >Apply Mapping</a
        >
      </div>
    </div>

    <div id="modal-exceptions" class="modal modal-fixed-footer">
      <div class="modal-content">
        <h5 data-translate="assign_exceptions_title">Assign exceptions...</h5>
        <p data-translate="assign_exceptions_desc">
          For any area or zone below, you can enter a city name to override the
          default. Check "Apply" to save the exception.
        </p>
        <div id="exceptions-assign"></div>
      </div>
      <div class="modal-footer">
        <a
          id="btn-exceptions-apply"
          class="modal-close btn"
          data-translate="save_exceptions"
          >Save Exceptions</a
        >
      </div>
    </div>

    <div id="modal-transport-defaults" class="modal modal-fixed-footer">
      <div class="modal-content">
        <h5 data-translate="transport_defaults_title">
          Set Default Transportation
        </h5>
        <p data-translate="transport_defaults_desc">
          Select the default mode of transport for each travel group. This will
          be applied to all missionaries in that group.
        </p>
        <div id="transport-defaults-list"></div>
      </div>
      <div class="modal-footer">
        <a id="btn-transport-apply" class="modal-close btn">Apply & Process</a>
      </div>
    </div>

    <div id="modal-calendar" class="modal modal-fixed-footer">
      <div class="modal-content">
        <h5 data-translate="calendar_event_title">
          Add Missionaries to Calendar Event
        </h5>
        <div class="row">
          <div class="input-field col s12">
            <input
              id="calendar-event-title"
              type="text"
              value="Missionary Travel"
            />
            <label for="calendar-event-title" data-translate="event_title"
              >Event Title</label
            >
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            <h6 data-translate="time_date">Time & Date:</h6>
            <p id="calendar-time-date"></p>
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <h6 data-translate="event_description">Description:</h6>
            <p id="calendar-description-preview"></p>
          </div>
        </div>

        <div class="row">
          <div class="col s12">
            <h6 data-translate="select_missionaries">
              Select Missionaries to Add:
            </h6>
            <div id="missionaries-checkbox-list"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a
          id="btn-export-outlook"
          class="btn blue darken-2"
          data-translate="export_outlook"
          >Export to Outlook Calendar</a
        >
        <a id="btn-export-google" class="btn red" data-translate="export_google"
          >Export to Google Calendar</a
        >
      </div>
    </div>
    <script src="translation.js"></script>
    <script src="script.js"></script>
  </body>
</html>
